# **What is CNI**

**CNI (Container Network Interface)** is a specification and a set of libraries that define how networking is configured for containers in a cloud-native environment. CNI plugins are used to implement the CNI specification and manage the networking of containers in a Kubernetes cluster.

## K8s imposes some networking rules

- all pods can communicate with each other without NAT
- agents on a node can communicate with all pods on that node

## There are three types of networking in K8s

- **Pod Network**: A set of private IPs for pods to communicate with each other
- **Node Network**: A set of private IPs for nodes to communicate with each other
- **Cluster Network**: A set of private IPs for pods to communicate with nodes

## **Why CNI is Important in Kubernetes:**

Kubernetes relies on CNI plugins to manage the networking of pods (the smallest deployable units in Kubernetes). These plugins handle the setup and teardown of network interfaces for pods, ensuring that they can communicate across the cluster and with the outside world.

## **Key Components of CNI:**

1. **CNI Plugins:**

   - **Network Plugins:** These are the actual implementations of networking, such as Flannel, Calico, Weave, and others. Each plugin has its own way of handling the network setup, but they all adhere to the CNI specification.
   - **IPAM Plugins:** IPAM stands for IP Address Management. These plugins manage the allocation of IP addresses to the pods. Some CNI plugins include their own IPAM functionality, while others can work with separate IPAM plugins.

2. **CNI Specification:**
   - **Standard Interface:** The CNI specification defines a standard interface that CNI plugins must implement. This allows Kubernetes to work with different CNI plugins interchangeably.
   - **Configuration Files:** CNI plugins are configured using JSON files, which specify the network settings that should be applied to containers.

## **How CNI Works in Kubernetes:**

1. **Pod Creation:**

   - When Kubernetes schedules a pod to run on a node, it asks the CNI plugin to set up the networking for that pod.
   - This involves creating a network interface for the pod and assigning it an IP address.

2. **CNI Plugin Execution:**

   - The Kubernetes kubelet (the agent running on each node) invokes the CNI plugin when a pod is created.
   - The CNI plugin configures the network interface for the pod, connects it to the appropriate network, and assigns it an IP address.

3. **Network Connectivity:**

   - After the network interface is set up, the pod can communicate with other pods in the cluster and with external services.
   - The CNI plugin also takes care of setting up routing rules so that network traffic can flow correctly between pods, services, and the outside world.

4. **Pod Deletion:**
   - When a pod is deleted, the CNI plugin is called again to tear down the network interface and clean up any resources associated with the pod’s network configuration.

## **Types of CNI Plugins:**

1. **Basic Network Plugins:**

   - **Flannel:** A simple and popular CNI plugin that creates an overlay network using VXLAN, allowing pods across different nodes to communicate.
   - **Weave:** Creates a mesh network where all nodes can communicate directly, using a user-space process for packet routing.

2. **Advanced Network Plugins:**

   - **Calico:** Provides Layer 3 networking using native Linux routing and BGP. Calico is known for its scalability and advanced network policy features.
   - **Cilium:** Focuses on providing secure networking using eBPF (extended Berkeley Packet Filter) in the Linux kernel. It supports Layer 7 (application layer) policies.

3. **Specialized Plugins:**
   - **Multus:** Allows you to attach multiple network interfaces to a single pod, enabling more complex network setups.
   - **SR-IOV:** Provides high-performance networking by allowing direct access to network hardware, bypassing the kernel’s networking stack.

## **CNI in Practice:**

- **Cluster Networking:** CNI plugins ensure that each pod gets a unique IP address and can communicate with other pods, services, and external networks. This is essential for the distributed nature of Kubernetes applications.
- **Network Policies:** Some CNI plugins (like Calico and Cilium) support Kubernetes network policies, which allow you to define rules about which pods can communicate with each other. This is important for securing your applications.

## **Simple Explanation of CNI:**

Think of Kubernetes as a large warehouse with many rooms (nodes) where workers (pods) need to communicate with each other. However, to do their work, each worker needs a phone line (network interface) to talk to other workers and external partners (other pods and external services).

The CNI (Container Network Interface) is like a phone company that sets up these phone lines. When a new worker arrives (a pod is created), the phone company (CNI plugin) installs a new phone line (sets up a network interface), assigns a phone number (an IP address), and connects the worker to the internal and external communication networks.

When the worker leaves (the pod is deleted), the phone company comes back to disconnect the line and free up the phone number (clean up the network resources).

Different phone companies (CNI plugins like Flannel, Calico, or Weave) might have different methods for setting up these phone lines, but they all ensure that the workers can communicate effectively and securely.

## **Conclusion:**

CNI is a critical component in Kubernetes networking. It provides the standard interface that enables different plugins to manage network setup and communication between pods in a consistent and scalable way. Understanding CNI and choosing the right CNI plugin based on your specific needs is key to successfully deploying and managing a Kubernetes cluster.
